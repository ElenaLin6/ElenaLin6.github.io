{"title":"","slug":"腾讯云聊天室Fiora","date":"2021-08-27T01:55:07.402Z","updated":"2021-08-27T02:03:55.737Z","comments":true,"path":"api/articles/腾讯云聊天室Fiora.json","excerpt":null,"covers":["https://pic.iczkj.com/pic/2021/08/27/36fd2aa3c1d3f.png","https://pic.iczkj.com/pic/2021/08/27/1c6120a56c1a5.png"],"content":"<p>这是基于 fiora 开源系统搭建的一个即时在线聊天室，使用宝塔面板搭建。只需一键注册即可享受在线聊天的乐趣。</p>\n<h3 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h3>\n<p>本项目基于腾讯云轻量搭建，目前腾讯云启动了无忧计划，超级划算，欢迎大家选购～购买链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jdXJsLnFjbG91ZC5jb20vMUkyazloN0Q=\">无忧计划</span></p>\n<p><img data-src=\"https://pic.iczkj.com/pic/2021/08/27/36fd2aa3c1d3f.png\" alt=\"wuyou\" /></p>\n<h3 id=\"fiora\"><a class=\"anchor\" href=\"#fiora\">#</a> Fiora</h3>\n<p>Fiora 聊天室是基于 node.js 和 react 由碎碎酱独自开发的开源网页聊天室，使用 socket.io 模块 WebSocket 协议通讯，支持 Service Worker 和 PWA. 功能丰富，并且简单易上手，很适合作为学习 node.js 的参考项目，node.js 初学者的福音。</p>\n<p>项目地址:</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lpbnhpbjYzMC9maW9yYQ==\">https://github.com/yinxin630/fiora</span></p>\n<h3 id=\"宝塔安装fiora\"><a class=\"anchor\" href=\"#宝塔安装fiora\">#</a> 宝塔安装 Fiora</h3>\n<ol>\n<li>自我安装好宝塔。<br />\ncentos 安装命令，其余系统请参见官网</li>\n</ol>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum install <span class=\"token punctuation\">-</span>y wget <span class=\"token important\">&amp;&amp;</span> wget <span class=\"token punctuation\">-</span>O install.sh http<span class=\"token punctuation\">:</span>//download.bt.cn/install/install_6.0.sh <span class=\"token important\">&amp;&amp;</span> sh install.sh</pre></td></tr></table></figure><ol start=\"2\">\n<li>在 软件商店 安装好 PM2 管理器、MongoDB、Redis，三个应用。</li>\n</ol>\n<p><img data-src=\"https://pic.iczkj.com/pic/2021/08/27/1c6120a56c1a5.png\" alt=\"\" /></p>\n<ol start=\"3\">\n<li>\n<p>如有外部安全防火墙 请预先开放 9200 端口，宝塔开启 9200 端口。</p>\n</li>\n<li>\n<p>ssh 连接服务器</p>\n</li>\n</ol>\n<p>先测试下环境是否正常 没有的退出重新连接 SSH</p>\n<pre><code class=\"language-node\">node -v\nnpm -v\n</code></pre>\n<p>拉取源码并存放于 /opt 文件夹 如果没有 git 请</p>\n<pre><code class=\"language-yum\">yum -y install git\n</code></pre>\n<p>git clone <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lpbnhpbjYzMC9maW9yYS5naXQ=\">https://github.com/yinxin630/fiora.git</span> -b master /opt/fiora</p>\n<p>进入文件夹</p>\n<pre><code class=\"language-cd\">cd /opt/fiora\n</code></pre>\n<p>安装依赖，这里不能用 npm，需要用 yarn 来安装</p>\n<pre><code class=\"language-npm\">npm i -g yarn\nyarn\n</code></pre>\n<p>构建和转移产物</p>\n<pre><code class=\"language-npm\">npm run build:client &amp;&amp; npm run move-dist\n</code></pre>\n<p>启动</p>\n<pre><code class=\"language-npm\">npm start\n</code></pre>\n<p>注册用户<br />\n打开   <code>http://你服务器ip:9200</code>  注册第一个用户: admin</p>\n<p>接下来配置管理员和开机自启 ，先使用 Ctrl+C 断开运行。</p>\n<p>先给 node 做个软连接，不然后面会启动失败</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ln <span class=\"token punctuation\">-</span>sf $(which node) /usr/bin/node</pre></td></tr></table></figure><p>获取用户 userid 比如 admin</p>\n<pre><code class=\"language-yarn\">yarn script getUserId admin\n</code></pre>\n<p>设置管理员 替换下面红色的内容成上面取到的 Userid</p>\n<p><code>export Administrator=内容 Port=9200</code></p>\n<p>[typing] 以下命令一起复制进 SSH 客户端运行 [/typing]</p>\n<p>cat &gt; /etc/systemd/system/fiora.service &lt;&lt;EOF<br />\n[Unit]<br />\nDescription=fiora<br />\nAfter=network.target<br />\nWants=network.target</p>\n<p>[Service]<br />\nType=simple<br />\nPIDFile=/var/run/fiora.pid<br />\nExecStart=<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>a</mi><mi>n</mi><mi>d</mi><mo>−</mo><mi>v</mi><mi>n</mi><mi>p</mi><mi>m</mi><mo stretchy=\"false\">)</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>W</mi><mi>o</mi><mi>r</mi><mi>k</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>D</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>y</mi><mo>=</mo><mi mathvariant=\"normal\">/</mi><mi>o</mi><mi>p</mi><mi>t</mi><mi mathvariant=\"normal\">/</mi><mi>f</mi><mi>i</mi><mi>o</mi><mi>r</mi><mi>a</mi><mi>E</mi><mi>n</mi><mi>v</mi><mi>i</mi><mi>r</mi><mi>o</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>=</mo><mi>N</mi><mi>O</mi><mi>D</mi><msub><mi>E</mi><mi>E</mi></msub><mi>N</mi><mi>V</mi><mo>=</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>A</mi><mi>d</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo></mrow><annotation encoding=\"application/x-tex\">(command -v npm) start\nWorkingDirectory=/opt/fiora\nEnvironment=NODE_ENV=production Administrator=</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">/</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">t</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">E</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span></span></span></span>Administrator Port=$Port<br />\nUser=root<br />\nRestart=on-failure<br />\nRestartSec=42s</p>\n<p>[Install]<br />\nWantedBy=multi-user.target<br />\nEOF</p>\n<p>设置开机启动</p>\n<p><code>systemctl start fiora</code></p>\n<p>[typing] 在开机时启用服务 [/typing]</p>\n<p><code>systemctl enable fiora</code></p>\n<p>至此重启，可使管理员权限生效。下面是其它参考内容，如修改 fiora 内容，往往需要重构才能生效。</p>\n<p>在开机时禁用服务 (此命令不用，仅参考。)</p>\n<p>systemctl disable fiora</p>\n<p>重构 (此命令不用，仅参考。)</p>\n<p>npm script build:client</p>\n<h3 id=\"域名反代\"><a class=\"anchor\" href=\"#域名反代\">#</a> 域名反代</h3>\n<p>如需要加证书，申请 / 更换 ssl 时需关闭域名反代。</p>\n<ol>\n<li>\n<p>宝塔面板里面，先点击左侧网站，添加站点，然后再点击添加好了的域名</p>\n</li>\n<li>\n<p>网址 - 域名 - 设置 - 反向代理 - 增加反向代理</p>\n</li>\n<li>\n<p>目标 URL  <code>http://127.0.0.1:9200</code></p>\n</li>\n</ol>\n<p>打开你的域名，就可以看到 Fiora 在运行了。</p>\n<p>其它的设置事项，请参考官方说明。</p>\n<h3 id=\"一些修正\"><a class=\"anchor\" href=\"#一些修正\">#</a> 一些修正</h3>\n<p>1. 套 cdn 不能注册新用户</p>\n<p>进入 opt\\fiora\\server\\routes\\user.ts 注释第 85 86 行。</p>\n<p>// const hasRegisteredWithin24Hours = await Redis.has(getNewRegisteredUserIpKey(ctx.socket.ip));</p>\n<p>//assert (!hasRegisteredWithin24Hours, ' 系统错误 ');</p>\n<p>2. 缓存问题 如修改后 ip:9200 访问正常 域名访问还是旧文件</p>\n<p>关闭 反向代理的 开启缓存</p>\n<p>删除反向代理 --&gt; 配置文件里 expires 12h;</p>\n<p>清空 /www/server/nginx/proxy_cache_dir/ 夹里文件</p>\n<p>清空 /www/server/nginx/proxy_temp_dir/ 夹里文件</p>\n<p>如有 cdn 也需要清除 cdn 缓存</p>\n<p>强制刷新 / 清空浏览器缓存 重新访问</p>\n<h3 id=\"diy\"><a class=\"anchor\" href=\"#diy\">#</a> DIY</h3>\n<p>logo:</p>\n<p>/opt/fiora/public/favicon-96.png</p>\n<p>/opt/fiora/public/favicon-192.png</p>\n<p>/opt/fiora/public/favicon-512.png</p>\n<p>index.html</p>\n<p>/opt/fiora/client/templates/index.html</p>\n<p>侧边</p>\n<p>/opt/fiora/client/modules/Sidebar/</p>\n<h3 id=\"安全\"><a class=\"anchor\" href=\"#安全\">#</a> 安全</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lpbnhpbjYzMC9maW9yYS9ibG9iL21hc3Rlci9kb2MvSU5TVEFMTC5aSC5tZA==\">https://github.com/yinxin630/fiora/blob/master/doc/INSTALL.ZH.md</span></p>\n<p>请按项目配置里提到的方法，在 fiora 根目录，新建 .env 文件</p>\n<p>修改 JwtSecret 的值</p>\n","more":"<p>这是基于 fiora 开源系统搭建的一个即时在线聊天室，使用宝塔面板搭建。只需一键注册即可享受在线聊天的乐趣。</p>\n<h3 id=\"前言\"><a class=\"anchor\" href=\"#前言\">#</a> 前言</h3>\n<p>本项目基于腾讯云轻量搭建，目前腾讯云启动了无忧计划，超级划算，欢迎大家选购～购买链接：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9jdXJsLnFjbG91ZC5jb20vMUkyazloN0Q=\">无忧计划</span></p>\n<p><img data-src=\"https://pic.iczkj.com/pic/2021/08/27/36fd2aa3c1d3f.png\" alt=\"wuyou\" /></p>\n<h3 id=\"fiora\"><a class=\"anchor\" href=\"#fiora\">#</a> Fiora</h3>\n<p>Fiora 聊天室是基于 node.js 和 react 由碎碎酱独自开发的开源网页聊天室，使用 socket.io 模块 WebSocket 协议通讯，支持 Service Worker 和 PWA. 功能丰富，并且简单易上手，很适合作为学习 node.js 的参考项目，node.js 初学者的福音。</p>\n<p>项目地址:</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lpbnhpbjYzMC9maW9yYQ==\">https://github.com/yinxin630/fiora</span></p>\n<h3 id=\"宝塔安装fiora\"><a class=\"anchor\" href=\"#宝塔安装fiora\">#</a> 宝塔安装 Fiora</h3>\n<ol>\n<li>自我安装好宝塔。<br />\ncentos 安装命令，其余系统请参见官网</li>\n</ol>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>yum install <span class=\"token punctuation\">-</span>y wget <span class=\"token important\">&amp;&amp;</span> wget <span class=\"token punctuation\">-</span>O install.sh http<span class=\"token punctuation\">:</span>//download.bt.cn/install/install_6.0.sh <span class=\"token important\">&amp;&amp;</span> sh install.sh</pre></td></tr></table></figure><ol start=\"2\">\n<li>在 软件商店 安装好 PM2 管理器、MongoDB、Redis，三个应用。</li>\n</ol>\n<p><img data-src=\"https://pic.iczkj.com/pic/2021/08/27/1c6120a56c1a5.png\" alt=\"\" /></p>\n<ol start=\"3\">\n<li>\n<p>如有外部安全防火墙 请预先开放 9200 端口，宝塔开启 9200 端口。</p>\n</li>\n<li>\n<p>ssh 连接服务器</p>\n</li>\n</ol>\n<p>先测试下环境是否正常 没有的退出重新连接 SSH</p>\n<pre><code class=\"language-node\">node -v\nnpm -v\n</code></pre>\n<p>拉取源码并存放于 /opt 文件夹 如果没有 git 请</p>\n<pre><code class=\"language-yum\">yum -y install git\n</code></pre>\n<p>git clone <span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lpbnhpbjYzMC9maW9yYS5naXQ=\">https://github.com/yinxin630/fiora.git</span> -b master /opt/fiora</p>\n<p>进入文件夹</p>\n<pre><code class=\"language-cd\">cd /opt/fiora\n</code></pre>\n<p>安装依赖，这里不能用 npm，需要用 yarn 来安装</p>\n<pre><code class=\"language-npm\">npm i -g yarn\nyarn\n</code></pre>\n<p>构建和转移产物</p>\n<pre><code class=\"language-npm\">npm run build:client &amp;&amp; npm run move-dist\n</code></pre>\n<p>启动</p>\n<pre><code class=\"language-npm\">npm start\n</code></pre>\n<p>注册用户<br />\n打开   <code>http://你服务器ip:9200</code>  注册第一个用户: admin</p>\n<p>接下来配置管理员和开机自启 ，先使用 Ctrl+C 断开运行。</p>\n<p>先给 node 做个软连接，不然后面会启动失败</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ln <span class=\"token punctuation\">-</span>sf $(which node) /usr/bin/node</pre></td></tr></table></figure><p>获取用户 userid 比如 admin</p>\n<pre><code class=\"language-yarn\">yarn script getUserId admin\n</code></pre>\n<p>设置管理员 替换下面红色的内容成上面取到的 Userid</p>\n<p><code>export Administrator=内容 Port=9200</code></p>\n<p>[typing] 以下命令一起复制进 SSH 客户端运行 [/typing]</p>\n<p>cat &gt; /etc/systemd/system/fiora.service &lt;&lt;EOF<br />\n[Unit]<br />\nDescription=fiora<br />\nAfter=network.target<br />\nWants=network.target</p>\n<p>[Service]<br />\nType=simple<br />\nPIDFile=/var/run/fiora.pid<br />\nExecStart=<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo stretchy=\"false\">(</mo><mi>c</mi><mi>o</mi><mi>m</mi><mi>m</mi><mi>a</mi><mi>n</mi><mi>d</mi><mo>−</mo><mi>v</mi><mi>n</mi><mi>p</mi><mi>m</mi><mo stretchy=\"false\">)</mo><mi>s</mi><mi>t</mi><mi>a</mi><mi>r</mi><mi>t</mi><mi>W</mi><mi>o</mi><mi>r</mi><mi>k</mi><mi>i</mi><mi>n</mi><mi>g</mi><mi>D</mi><mi>i</mi><mi>r</mi><mi>e</mi><mi>c</mi><mi>t</mi><mi>o</mi><mi>r</mi><mi>y</mi><mo>=</mo><mi mathvariant=\"normal\">/</mi><mi>o</mi><mi>p</mi><mi>t</mi><mi mathvariant=\"normal\">/</mi><mi>f</mi><mi>i</mi><mi>o</mi><mi>r</mi><mi>a</mi><mi>E</mi><mi>n</mi><mi>v</mi><mi>i</mi><mi>r</mi><mi>o</mi><mi>n</mi><mi>m</mi><mi>e</mi><mi>n</mi><mi>t</mi><mo>=</mo><mi>N</mi><mi>O</mi><mi>D</mi><msub><mi>E</mi><mi>E</mi></msub><mi>N</mi><mi>V</mi><mo>=</mo><mi>p</mi><mi>r</mi><mi>o</mi><mi>d</mi><mi>u</mi><mi>c</mi><mi>t</mi><mi>i</mi><mi>o</mi><mi>n</mi><mi>A</mi><mi>d</mi><mi>m</mi><mi>i</mi><mi>n</mi><mi>i</mi><mi>s</mi><mi>t</mi><mi>r</mi><mi>a</mi><mi>t</mi><mi>o</mi><mi>r</mi><mo>=</mo></mrow><annotation encoding=\"application/x-tex\">(command -v npm) start\nWorkingDirectory=/opt/fiora\nEnvironment=NODE_ENV=production Administrator=</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">d</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222222222222222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">m</span><span class=\"mclose\">)</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.13889em;\">W</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03148em;\">k</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord\">/</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\">t</span><span class=\"mord\">/</span><span class=\"mord mathnormal\" style=\"margin-right:0.10764em;\">f</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">v</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">t</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.83333em;vertical-align:-0.15em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">O</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">D</span><span class=\"mord\"><span class=\"mord mathnormal\" style=\"margin-right:0.05764em;\">E</span><span class=\"msupsub\"><span class=\"vlist-t vlist-t2\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.32833099999999993em;\"><span style=\"top:-2.5500000000000003em;margin-left:-0.05764em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.05764em;\">E</span></span></span></span><span class=\"vlist-s\">​</span></span><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.15em;\"><span></span></span></span></span></span></span><span class=\"mord mathnormal\" style=\"margin-right:0.10903em;\">N</span><span class=\"mord mathnormal\" style=\"margin-right:0.22222em;\">V</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8888799999999999em;vertical-align:-0.19444em;\"></span><span class=\"mord mathnormal\">p</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">u</span><span class=\"mord mathnormal\">c</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">A</span><span class=\"mord mathnormal\">d</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">n</span><span class=\"mord mathnormal\">i</span><span class=\"mord mathnormal\">s</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\">t</span><span class=\"mord mathnormal\">o</span><span class=\"mord mathnormal\" style=\"margin-right:0.02778em;\">r</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">=</span></span></span></span>Administrator Port=$Port<br />\nUser=root<br />\nRestart=on-failure<br />\nRestartSec=42s</p>\n<p>[Install]<br />\nWantedBy=multi-user.target<br />\nEOF</p>\n<p>设置开机启动</p>\n<p><code>systemctl start fiora</code></p>\n<p>[typing] 在开机时启用服务 [/typing]</p>\n<p><code>systemctl enable fiora</code></p>\n<p>至此重启，可使管理员权限生效。下面是其它参考内容，如修改 fiora 内容，往往需要重构才能生效。</p>\n<p>在开机时禁用服务 (此命令不用，仅参考。)</p>\n<p>systemctl disable fiora</p>\n<p>重构 (此命令不用，仅参考。)</p>\n<p>npm script build:client</p>\n<h3 id=\"域名反代\"><a class=\"anchor\" href=\"#域名反代\">#</a> 域名反代</h3>\n<p>如需要加证书，申请 / 更换 ssl 时需关闭域名反代。</p>\n<ol>\n<li>\n<p>宝塔面板里面，先点击左侧网站，添加站点，然后再点击添加好了的域名</p>\n</li>\n<li>\n<p>网址 - 域名 - 设置 - 反向代理 - 增加反向代理</p>\n</li>\n<li>\n<p>目标 URL  <code>http://127.0.0.1:9200</code></p>\n</li>\n</ol>\n<p>打开你的域名，就可以看到 Fiora 在运行了。</p>\n<p>其它的设置事项，请参考官方说明。</p>\n<h3 id=\"一些修正\"><a class=\"anchor\" href=\"#一些修正\">#</a> 一些修正</h3>\n<p>1. 套 cdn 不能注册新用户</p>\n<p>进入 opt\\fiora\\server\\routes\\user.ts 注释第 85 86 行。</p>\n<p>// const hasRegisteredWithin24Hours = await Redis.has(getNewRegisteredUserIpKey(ctx.socket.ip));</p>\n<p>//assert (!hasRegisteredWithin24Hours, ' 系统错误 ');</p>\n<p>2. 缓存问题 如修改后 ip:9200 访问正常 域名访问还是旧文件</p>\n<p>关闭 反向代理的 开启缓存</p>\n<p>删除反向代理 --&gt; 配置文件里 expires 12h;</p>\n<p>清空 /www/server/nginx/proxy_cache_dir/ 夹里文件</p>\n<p>清空 /www/server/nginx/proxy_temp_dir/ 夹里文件</p>\n<p>如有 cdn 也需要清除 cdn 缓存</p>\n<p>强制刷新 / 清空浏览器缓存 重新访问</p>\n<h3 id=\"diy\"><a class=\"anchor\" href=\"#diy\">#</a> DIY</h3>\n<p>logo:</p>\n<p>/opt/fiora/public/favicon-96.png</p>\n<p>/opt/fiora/public/favicon-192.png</p>\n<p>/opt/fiora/public/favicon-512.png</p>\n<p>index.html</p>\n<p>/opt/fiora/client/templates/index.html</p>\n<p>侧边</p>\n<p>/opt/fiora/client/modules/Sidebar/</p>\n<h3 id=\"安全\"><a class=\"anchor\" href=\"#安全\">#</a> 安全</h3>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL3lpbnhpbjYzMC9maW9yYS9ibG9iL21hc3Rlci9kb2MvSU5TVEFMTC5aSC5tZA==\">https://github.com/yinxin630/fiora/blob/master/doc/INSTALL.ZH.md</span></p>\n<p>请按项目配置里提到的方法，在 fiora 根目录，新建 .env 文件</p>\n<p>修改 JwtSecret 的值</p>\n","categories":[],"tags":[]}